/* html-palette v1.0.1 - built on 2015-09-16 */
"use strict";!function(a,b){function c(a,b,c){if(0===b)return{r:c,g:c,b:c};var d=Math.floor(6*a),e=6*a-d,f=c*(1-b),g=c*(1-b*e),h=c*(1-b*(1-e));switch(d%6){case 0:return{r:c,g:h,b:f};case 1:return{r:g,g:c,b:f};case 2:return{r:f,g:c,b:h};case 3:return{r:f,g:g,b:c};case 4:return{r:h,g:f,b:c};default:return{r:c,g:f,b:g}}}function d(a,b,c){var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=f,i=f-g;if(e=0===f?0:i/f,f==g)d=0;else{switch(f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}d/=6}return{h:d,s:e,v:h}}var e='<div class="palette">\n	<canvas width="1" height="1"></canvas>\n	<div class="alpha" draggable="true"></div>\n	<div class="twoaxis" draggable="true"></div>\n	<div class="oneaxis" draggable="true"></div>\n</div>\n<div class="controls">\n	<div class="rgbInput">\n		#\n		<span class="r" draggable="true"></span>\n		<span class="g" draggable="true"></span>\n		<span class="b" draggable="true"></span>\n		<span class="a" draggable="true"></span>\n	</div>\n	<div class="colorswatch"></div>\n</div>\n',f="precision lowp float;\nattribute vec3 vertPosition;\nvarying vec2 windowPosition;\nuniform vec2 windowDimensions;\n\nvoid main(void)\n{\n	mat3 xform = mat3(0.5*windowDimensions.x, 0.0, 0.0, 0.0, 0.5*windowDimensions.y, 0.0, windowDimensions.x/2.0, windowDimensions.y/2.0, 1.0);\n	windowPosition = (xform * vec3(vertPosition.xy, 1.0)).xy;\n	gl_Position = vec4(vertPosition,1);\n}\n\n",g="precision lowp float;\n#define M_PI 3.141592653589\n\nvarying vec2 windowPosition;\nuniform vec4 selectedColor;\nuniform float swatchWidth;\nuniform float marginWidth;\nuniform vec2 windowDimensions;\nuniform bool radial;\nuniform bool useAlpha;\nuniform sampler2D tex;\n\nvec3 hsv2rgb(vec3 c){\n	vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n	vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n	return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\n\nvec4 getSelectionColor(vec4 baseColor){\n	return vec4( vec3(1.0)-baseColor.rgb, baseColor.a );\n}\n\nvoid main(void){\n\n	float taLeft = useAlpha ? swatchWidth + marginWidth : 0.0;\n	float taWidth = windowDimensions.x - swatchWidth - marginWidth - taLeft;\n	vec2 center = vec2(taWidth/2.0+taLeft, windowDimensions.y/2.0);\n	float aspect = taWidth / windowDimensions.y;\n	vec4 color;\n	vec2 selectionPosition;\n\n	if( windowPosition.x >= taLeft &&  windowPosition.x <= taLeft+taWidth )\n	{\n		if(radial)\n		{\n			vec2 radialVec = (windowPosition - center)*vec2(2.0/taWidth, 2.0/windowDimensions.y);\n			radialVec = mat2(max(1.0,aspect), 0.0, 0.0, max(1.0,1.0/aspect)) * radialVec;\n			if(length(radialVec) > 1.0) discard;\n			float hue = atan(radialVec.y,radialVec.x)/(2.0*M_PI) + 0.5;\n			color = vec4(hue, length(radialVec), selectedColor.z, 1.0);\n\n			float angle = (selectedColor.x-0.5)*2.0*M_PI;\n			selectionPosition = min(center.x-taLeft, center.y) * selectedColor.y * vec2(cos(angle), sin(angle)) + center;\n		}\n		else {\n			color = vec4((windowPosition.x-taLeft)/taWidth, windowPosition.y/windowDimensions.y, selectedColor.z, 1.0);\n			selectionPosition = vec2(selectedColor.x*taWidth+taLeft, selectedColor.y*windowDimensions.y);\n		}\n\n		vec2 difference = selectionPosition - windowPosition;\n		float radius = length(difference);\n\n		if( radius > 4.5 && radius < 6.0 )\n			gl_FragColor = getSelectionColor(vec4(hsv2rgb(color.xyz), 1.0 ));\n		else\n			gl_FragColor = vec4( hsv2rgb(color.xyz), 1.0);\n	}\n\n	else if(useAlpha && windowPosition.x < swatchWidth)\n	{\n		vec4 color = vec4(mix( texture2D(tex, windowPosition/16.0).xyz, hsv2rgb(selectedColor.xyz), windowPosition.y/windowDimensions.y), 1.0);\n\n		if( windowDimensions.y * abs(windowPosition.y/windowDimensions.y-selectedColor.w) < 1.0 )\n			gl_FragColor = getSelectionColor(color);\n		else\n			gl_FragColor = color;\n	}\n\n	else if(windowPosition.x > windowDimensions.x-swatchWidth)\n	{\n		vec4 color = vec4( selectedColor.x, selectedColor.y, windowPosition.y/windowDimensions.y, 1.0);\n\n		if( windowDimensions.y * abs(windowPosition.y/windowDimensions.y-selectedColor.z) < 1.0 )\n			gl_FragColor = getSelectionColor(vec4(hsv2rgb(color.xyz), 1.0 ));\n		else\n			gl_FragColor = vec4( hsv2rgb(color.xyz), 1.0);\n	}\n	else\n		discard;\n}\n\n",h="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAK0lEQVQoz2Pcu3cvAzbg5OSEVZyJgUQwqoEYwPj//3+sEvv27RsNJfppAAD+GAhT8tRPqwAAAABJRU5ErkJggg==",i=document.createElement("style");i.type="text/css",i.innerHTML="html-palette,.html-palette{display:inline-block;width:30px;height:30px;border:ridge lightgrey 3px}.htmlPalette{width:200px;height:200px;border:solid grey 1px;padding:5px;background-color:white;display:-webkit-box;display:-moz-flex;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-moz-flex-direction:column;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;position:absolute;box-sizing:border-box}.htmlPalette .palette{position:relative;padding:1px;-moz-flex-grow:1;-ms-flex:1 1;-webkit-flex-grow:1;flex-grow:1}.htmlPalette .palette .twoaxis,.htmlPalette .palette .oneaxis,.htmlPalette .palette .alpha{position:absolute;border:solid grey 1px}.htmlPalette .palette .twoaxis{top:0px;left:30px;cursor:crosshair}.htmlPalette .palette .oneaxis{top:0px;right:0px;width:20px;margin-left:10px;cursor:ns-resize}.htmlPalette .palette .alpha{top:0px;left:0px;width:20px;margin-right:10px;cursor:ns-resize}.htmlPalette .controls{height:30px;-moz-flex-shrink:0;-ms-flex-shrink:0;-webkit-flex-shrink:0;flex-shrink:0;display:-webkit-box;display:-moz-flex;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-orient:horizontal;-moz-flex-direction:row;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-webkit-box-align:stretch;-moz-align-items:stretch;-ms-flex-align:stretch;-webkit-align-items:stretch;align-items:stretch;-webkit-box-pack:justify;-moz-justify-content:space-between;-ms-flex-pack:justify;-webkit-justify-content:space-between;justify-content:space-between}.htmlPalette .controls .rgbInput{display:-webkit-box;display:-moz-flex;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-align:center;-moz-align-items:center;-ms-flex-align:center;-webkit-align-items:center;align-items:center;padding-left:5px;font-size:20px;letter-spacing:1px}.htmlPalette .controls .rgbInput span{margin:0 2px;cursor:ns-resize}.htmlPalette .controls .rgbInput .r{color:red}.htmlPalette .controls .rgbInput .g{color:green}.htmlPalette .controls .rgbInput .b{color:blue}.htmlPalette .controls .rgbInput .a{color:black}.htmlPalette .controls .colorswatch{width:25%;box-sizing:border-box;border:solid grey 1px}\n",document.head.appendChild(i),document.addEventListener("click",function(a){for(var b=document.querySelectorAll(".htmlPalette"),c=0;c<b.length;c++)b.item(c)!==self.elem&&(b.item(c).style.display="none")});var j=function(a,b){function c(a,b){a.ondragstart=function(a){z=Math.round(255*w.selection[b]),A=a.offsetY,a.dataTransfer.effectAllowed="none",a.dataTransfer.setDragImage(document.createElement("div"),0,0)},a.ondrag=function(a){var c=z+A-a.offsetY;if(0!==a.screenX||0!==a.screenY){var d={};d[b]=Math.max(0,Math.min(1,c/255)),w.color(d)}}}b=b||{},this.elem=document.createElement("div"),this.elem.setAttribute("class","htmlPalette"+(b.css?" "+b.css:"")),this.elem.innerHTML=e,this.elem.onclick=function(a){a.stopPropagation()},document.body.appendChild(this.elem),this.triggerElem=a,this._onclick=j.onclick.bind(this),this.triggerElem.addEventListener("click",this._onclick),this.colorCallback=b.colorCallback||null,this.popupEdge=b.popupEdge||"se",this.radial=b.radial||!1,this.useAlpha=b.useAlpha||!1,this.updateTriggerBg=void 0!==b.updateTriggerBg?b.updateTriggerBg:!0,this.disabled=b.disabled||!1,this.selection={},this._canvas=this.elem.querySelector("canvas"),this._gl=this._canvas.getContext("webgl");var d=this._gl,i=window.getComputedStyle(this.elem);this._popupWidth=parseInt(i.width)||0,this._popupHeight=parseInt(i.height)||0;var k=window.getComputedStyle(this.elem.querySelector(".palette")),l=parseInt(k.width),m=parseInt(k.height)-1;this._canvas.width=l,this._canvas.height=m,d.viewport(0,0,l,m);var n=this.useAlpha?l-60:l-30,o=this.elem.querySelector(".twoaxis"),p=this.elem.querySelector(".oneaxis"),q=this.elem.querySelector(".alpha");o.style.width=n+"px",o.style.height=m+"px",p.style.height=m+"px",q.style.height=m+"px",this.elem.style.display="none",this.useAlpha||(q.style.display="none",this.elem.querySelector(".rgbInput .a").style.display="none",o.style.left="0px");var r=d.createShader(d.VERTEX_SHADER);if(d.shaderSource(r,f),d.compileShader(r),!d.getShaderParameter(r,d.COMPILE_STATUS))return void console.error("Vert shader error:",d.getShaderInfoLog(r));var s=d.createShader(d.FRAGMENT_SHADER);if(d.shaderSource(s,g),d.compileShader(s),!d.getShaderParameter(s,d.COMPILE_STATUS))return void console.error("Frag shader error:",d.getShaderInfoLog(s));var t=this._program=d.createProgram();if(d.attachShader(t,r),d.attachShader(t,s),d.linkProgram(t),!d.getProgramParameter(t,d.LINK_STATUS))return void console.error("Unable to link program");d.useProgram(t);var u=d.getAttribLocation(t,"vertPosition");d.enableVertexAttribArray(u);var v=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,v),d.bufferData(d.ARRAY_BUFFER,new Float32Array([-1,-1,0,-1,1,0,1,-1,0,1,1,0]),d.STATIC_DRAW),d.vertexAttribPointer(u,3,d.FLOAT,!1,0,0),this._selectionUniform=d.getUniformLocation(t,"selectedColor"),d.uniform1f(d.getUniformLocation(t,"swatchWidth"),20),d.uniform1f(d.getUniformLocation(t,"marginWidth"),10),d.uniform2f(d.getUniformLocation(t,"windowDimensions"),l,m),d.uniform1i(d.getUniformLocation(t,"useAlpha"),!!this.useAlpha);var w=this,x=d.createTexture(),y=new Image;y.onload=function(){d.bindTexture(d.TEXTURE_2D,x),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,y),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),w.redraw()},y.src=h,d.clearColor(0,0,0,0),this.color(b.initialColor||"aaaaaa"),o.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0)},o.ondrag=o.onmousedown=function(a){if(w.radial){var b=[n/2,m/2],c=[a.offsetX-1-b[0],-(a.offsetY-1)+b[1]],d=Math.atan2(c[1],c[0])/(2*Math.PI)+.5,e=Math.sqrt(c[0]*c[0]+c[1]*c[1])/Math.min(b[0],b[1]);(0!==a.screenX||0!==a.screenY)&&w.color({h:d,s:Math.min(e,1)})}else(0!==a.screenX||0!==a.screenY)&&w.color({h:Math.min(1,Math.max(0,(a.offsetX-1)/n)),s:Math.min(1,Math.max(0,(m-a.offsetY+1)/(m-1)))})},p.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0)},p.ondrag=p.onmousedown=function(a){(0!==a.screenX||0!==a.screenY)&&w.color({v:Math.max(0,Math.min(1,(m-a.offsetY-1)/(m-1)))})},q.ondragstart=function(a){a.dataTransfer.setDragImage(document.createElement("div"),0,0)},q.ondrag=q.onmousedown=function(a){(0!==a.screenX||0!==a.screenY)&&w.color({a:Math.max(0,Math.min(1,(m-a.offsetY-1)/(m-1)))})};var z,A;c(this.elem.querySelector(".r"),"r"),c(this.elem.querySelector(".g"),"g"),c(this.elem.querySelector(".b"),"b"),c(this.elem.querySelector(".a"),"a")};if(j.onclick=function(a){if(a.stopPropagation(),!this.disabled)for(var b=this.triggerElem.getBoundingClientRect(),c={x:(b.left+b.right)/2,y:(b.top+b.bottom)/2},d=document.querySelectorAll(".htmlPalette"),e=0;e<d.length;e++)if(d.item(e)===this.elem&&this.elem.style.display){var f=20;/^[ns]?[we]?$/.test(this.popupEdge)&&this.popupEdge||(this.popupEdge="se"),/^n/.test(this.popupEdge)?this.elem.style.top=c.y-this._popupHeight-f+"px":/^s/.test(this.popupEdge)?this.elem.style.top=c.y+f+"px":this.elem.style.top=c.y-this._popupHeight/2+"px",/e$/.test(this.popupEdge)?this.elem.style.left=c.x+f+"px":/w$/.test(this.popupEdge)?this.elem.style.left=c.x-this._popupWidth-f+"px":this.elem.style.left=c.x-this._popupWidth/2+"px",this.elem.style.display=""}else d.item(e).style.display="none"},j.prototype.redraw=function(){this._gl.uniform1i(this._gl.getUniformLocation(this._program,"radial"),!!this.radial),this._gl.uniform4f(this._selectionUniform,this.selection.h,this.selection.s,this.selection.v,this.selection.a),this._gl.clear(this._gl.COLOR_BUFFER_BIT),this._gl.drawArrays(this._gl.TRIANGLE_STRIP,0,4)},j.prototype.color=function(a){if(void 0===this.selection.a&&(this.selection.a=1),a&&void 0!==a.a&&(this.selection.a=a.a),!a)return this.selection;if(void 0!==a.h||void 0!==a.s||void 0!==a.v){void 0!==a.h&&(this.selection.h=a.h),void 0!==a.s&&(this.selection.s=a.s),void 0!==a.v&&(this.selection.v=a.v);var b=c(this.selection.h,this.selection.s,this.selection.v);this.selection.r=Math.max(b.r,0),this.selection.g=Math.max(b.g,0),this.selection.b=Math.max(b.b,0),this.selection.hex=("00"+Math.round(255*this.selection.r).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.g).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.b).toString(16)).slice(-2)}else if(void 0!==a.r||void 0!==a.g||void 0!==a.b){void 0!==a.r&&(this.selection.r=a.r),void 0!==a.g&&(this.selection.g=a.g),void 0!==a.b&&(this.selection.b=a.b);var e=d(this.selection.r,this.selection.g,this.selection.b);this.selection.h=e.h,this.selection.s=e.s,this.selection.v=e.v,this.selection.hex=("00"+Math.round(255*this.selection.r).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.g).toString(16)).slice(-2)+("00"+Math.round(255*this.selection.b).toString(16)).slice(-2)}else if(/^[0-9A-Fa-f]{6}$/.test(a)){this.selection.hex=a,a=parseInt(a,16),this.selection.r=((16711680&a)>>16)/255,this.selection.g=((65280&a)>>8)/255,this.selection.b=(255&a)/255;var e=d(this.selection.r,this.selection.g,this.selection.b);this.selection.h=e.h,this.selection.s=e.s,this.selection.v=e.v}if(a){this.redraw(),this.elem.querySelector(".rgbInput .r").innerHTML=this.selection.hex.slice(0,2),this.elem.querySelector(".rgbInput .g").innerHTML=this.selection.hex.slice(2,4),this.elem.querySelector(".rgbInput .b").innerHTML=this.selection.hex.slice(4,6),this.elem.querySelector(".rgbInput .a").innerHTML=("00"+Math.round(255*this.selection.a).toString(16)).slice(-2);var f=[Math.round(255*this.selection.r),Math.round(255*this.selection.g),Math.round(255*this.selection.b),this.selection.a];f="rgba("+f.join(",")+")",this.elem.querySelector(".colorswatch").style.background="linear-gradient("+f+","+f+"), url("+h+")",this.updateTriggerBg&&(this.triggerElem.style.background="linear-gradient("+f+","+f+"), url("+h+")"),this.colorCallback&&this.colorCallback(this.selection)}},j.prototype.destroy=function(){document.body.removeChild(this.elem),this.triggerElem.removeEventListener("click",this._onclick)},window.HtmlPalette=j,a&&a.fn.extend({HtmlPalette:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.data("HtmlPalette");if(!a)return c;if(a instanceof Object)c&&c.destroy(),c=this.data("HtmlPalette",new j(this[0],a)),c.colorCallback&&(c.colorCallback=c.colorCallback.bind(this));else{if(!c)throw new Error("HtmlPalette is uninitialized on this element");switch(a){case"color":if(!b.length)return c.color();c.color(b[0]);break;case"colorCallback":if(!b.length)return c.colorCallback;c.colorCallback=b[0].bind(this);break;case"popupEdge":if(!b.length)return c.popupEdge;c.popupEdge=b[0];break;case"radial":if(!b.length)return c.radial;c.radial=b[0],c.redraw();break;case"updateTriggerBg":if(!b.length)return c.updateTriggerBg;c.updateTriggerBg=b[0];break;case"disabled":if(!b.length)return c.disabled;c.disabled=b[0];break;case"redraw":c.redraw();break;case"destroy":c.destroy(),this.data("htmlPalette",null)}}}}),b){var k=b.module("html-palette",[]);k.directive("htmlPalette",["$timeout",function(a){return{restrict:"AE",scope:{hsvColor:"=",rgbColor:"=",hexColor:"=",radial:"=",disabled:"="},link:function(b,c,d){var e=new j(c[0],d),f=!1,g=!1;b.$watch("radial",function(a){e.radial=!!a,e.redraw()}),b.$watch("disabled",function(a){e.disabled=!!a}),c.bind("$destroy",function(){e.destroy()}),d.hsvColor?(e.colorCallback=function(c){f||(g=!0,b.hsvColor.h=c.h,b.hsvColor.s=c.s,b.hsvColor.v=c.v,b.hsvColor.a=c.a,a(function(){b.$apply(),g=!1}))},b.$watchCollection("hsvColor",function(a){a&&!g&&(f=!0,e.color(a),f=!1)}),e.color(b.hsvColor)):d.rgbColor?(e.colorCallback=function(c){f||(g=!0,b.rgbColor.r=c.r,b.rgbColor.g=c.g,b.rgbColor.b=c.b,b.rgbColor.a=c.a,a(function(){b.$apply(),g=!1}))},b.$watchCollection("rgbColor",function(a){a&&!g&&(f=!0,e.color(a),f=!1)}),e.color(b.rgbColor)):d.hexColor&&(e.colorCallback=function(c){f||(g=!0,b.hexColor=c.hex,a(function(){b.$apply(),g=!1}))},b.$watch("hexColor",function(a){a&&!g&&(f=!0,e.color(a),f=!1)}),e.color(b.hexColor))}}}])}}(window.jQuery,window.angular);